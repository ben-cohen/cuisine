%% This is file `cuisine.sty'
%%
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Identification section
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cuisine}[2000/04/11 v0.00 recipe typesetting]
%
% Use the nicefrac package for "nice" fractions...
\RequirePackage{nicefrac}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Variables and counters etc.
%
% r@cipenumber   - Recipe number counter
%                  This could be made dependent on, say, section.
\newcounter{r@cipenumber}
%
% command to reset it
\DeclareRobustCommand{\ResetRecipeCounter}{\setcounter{r@cipenumber}{0}}
%
% m@thodnumber   - Method counter (within recipes)
%                  It is zeroed whenever the recipe counter is incremented.
\newcounter{m@thodnumber}[r@cipenumber]  
%
% ifnumb@ring     - Whether or not recipe numbers are printed 
\newif\ifnumb@ring
%
% ifind@xing     - Whether writing the recipes to an index file or not
\newif\ifind@xing
%
% And some dimensions:
%
% Width of the recipe number box
\newlength{\R@cipeNumberWidth}
%
% Width of the recipe title box
\newlength{\R@cipeTitleWidth}
%
% Width of the recipe number-of-servings box
\newlength{\R@cipeServingsWidth}
%
% Height of the recipe title to rule adjustments (usually negative)
\newlength{\R@cipeTitleVerticalAdjustTop}
\newlength{\R@cipeTitleVerticalAdjustBot}
%
% Width of the ingredients
\newlength{\R@cipeIngredientWidth}
\newlength{\R@cipeQuantityWidth}
\newlength{\R@cipeUnitsWidth}
\newlength{\R@cipeQandUWidth}   % total of the previous two...
%
% Width of the method text
\newlength{\R@cipeMethodWidth}
%
% Temporary parindent
\newlength{\R@cipeTempParindent}
%
% Relevant definitions for setting the above values:
%
%   #1 is the ingredient width, #2 the quantity, #3 the units
%   others calculated
\DeclareRobustCommand{\RecipeMethodWidths}[3]{%
\setlength{\R@cipeIngredientWidth}{#1}%
\setlength{\R@cipeQuantityWidth}{#2}%
\setlength{\R@cipeUnitsWidth}{#3}%
\setlength{\R@cipeQandUWidth}{\R@cipeQuantityWidth}%
\addtolength{\R@cipeQandUWidth}{\R@cipeUnitsWidth}%
\setlength{\R@cipeMethodWidth}{\textwidth}
\addtolength{\R@cipeMethodWidth}{-\R@cipeNumberWidth}%
\addtolength{\R@cipeMethodWidth}{-\R@cipeIngredientWidth}%
\addtolength{\R@cipeMethodWidth}{-\R@cipeQandUWidth}}
%
%   #1 is the recipe number width, #2 the number of servings
%   title width calculated, updates method widths too
\DeclareRobustCommand{\RecipeTitleWidths}[2]{%
\setlength{\R@cipeNumberWidth}{#1}%
\setlength{\R@cipeServingsWidth}{#2}%
\setlength{\R@cipeTitleWidth}{\textwidth}%
\addtolength{\R@cipeTitleWidth}{-\R@cipeNumberWidth}%
\addtolength{\R@cipeTitleWidth}{-\R@cipeServingsWidth}%
\RecipeMethodWidths{\R@cipeIngredientWidth}{\R@cipeQuantityWidth}%
                   {\R@cipeUnitsWidth}}
%
% default values:
\RecipeTitleWidths{0.8cm}{3cm}
\RecipeMethodWidths{4.5cm}{1cm}{2.5cm}
\setlength{\R@cipeTitleVerticalAdjustTop}{-0.25cm}
\setlength{\R@cipeTitleVerticalAdjustBot}{-0.04cm}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Options 
%
% nonumber - Should recipes be numbered?               Default - yes
\DeclareOption{number}{\numb@ringtrue}
\DeclareOption{nonumber}{\numb@ringfalse}
%
% index    - Should recipes be indexed to a file?      Default - no
\DeclareOption{index}{\ind@xingtrue}
\DeclareOption{noindex}{\ind@xingfalse}
%
% Process the options, using defaults
\ExecuteOptions{number,noindex}
\ProcessOptions\relax
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The recipe environment
%   #1 = title, #2 = portions, #3 = preparation time
\newenvironment{recipe}[3]{%
% These are the things that are put at the start of recipes:
%
% -- set-up things
\stepcounter{r@cipenumber}
\setlength{\R@cipeTempParindent}{\parindent}
\setlength{\parindent}{0pt}
%
% -- and the actual displayed title

\medskip
% ---- line 1
\mbox{%
\ifnumb@ring%
\makebox[\R@cipeNumberWidth][c]{\arabic{r@cipenumber}}%
\parbox[b]{\R@cipeTitleWidth}{#1}%
\else%
\parbox[b]{\R@cipeTitleWidth}{#1}%
\makebox[\R@cipeNumberWidth]{}%
\fi%
\parbox[b]{\R@cipeServingsWidth}{\hfill #2}}\par%
% ---- rule
\vspace{\R@cipeTitleVerticalAdjustTop}%
\rule{\textwidth}{0.4pt}\par%
\vspace{\R@cipeTitleVerticalAdjustBot}%
% ---- line 2
\makebox[\textwidth][r]{#3}\par%
%
%
}{%
% And these are the things put at the end of recipes:
%
% -- tidying up
\setlength{\parindent}{\R@cipeTempParindent}
}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Miscellaneous useful macros
%
% degrees        - to typeset a degrees symbol
\DeclareRobustCommand{\degrees}{${}^\circ$}
%
% fr             - to typeset fractions, currently using package nicefrac
\DeclareRobustCommand{\fr}[2]{\nicefrac#1#2}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% That's it...
%
\endinput
%
% END OF FILE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
